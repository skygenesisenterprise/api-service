// ======================================
// SKY GENESIS ENTERPRISE - API BACKEND
// SQLite Schema for Development
// ======================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ======================================
// ORGANIZATION MANAGEMENT
// ======================================

model Organization {
  id        String   @id @default(cuid())
  name      String   @unique
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  apiKeys ApiKey[]

  @@map("organizations")
}

// ======================================
// API KEY MANAGEMENT
// ======================================

model ApiKey {
  id           String   @id @default(cuid())
  key          String   @unique
  name         String
  category     String   // client, server, database
  permissions  String   // JSON string of permissions array
  organizationId String  @map("organization_id")
  userId       String?  @map("user_id")
  isActive     Boolean  @default(true) @map("is_active")
  expiresAt    DateTime? @map("expires_at")
  lastUsedAt   DateTime? @map("last_used_at")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  // Relations
  organization Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@map("api_keys")
}

// ======================================
// USER MANAGEMENT (Basic)
// ======================================

model User {
  id           String   @id @default(cuid())
  organizationId String? @map("organization_id")
  email        String   @unique
  fullName     String?  @map("full_name")
  passwordHash String   @map("password_hash")
  isActive     Boolean  @default(true) @map("is_active")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@map("users")
}